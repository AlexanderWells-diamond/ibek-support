# yaml-language-server: $schema=../_global/ibek.defs.schema.json

module: mrfTiming

defs:
  - name: EventReceiverPMC
    args:
      - type: id
        name: name
        description: A name to reference this EVR

      - type: int
        name: card_id
        description: EPICS Card id

      - type: int
        name: card_index
        description: PMC slot number
        default: 0

      - type: int
        name: priority
        description: Time provider priority
        default: 10

    script:
      - type: function
        name: ErConfigurePMC
        header: |
          #   Initialize a PMC Event Receiver card
        args:
          Card_Id: "{{ card_id }}"
          Card_Index: "{{ card_index }}"
      - type: once
        value: |
          # One time initialization for all event receivers
          ErTimeProviderInit {{ priority }}
          installLastResortEventProvider
          syncSysClock
