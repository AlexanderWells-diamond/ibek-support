# yaml-language-server: $schema=../schemas/ibek.support.schema.json

module: ADAravis

entity_models:
  - name: aravisCamera
    description: |-
      Creates an aravisCamera camera areaDetector driver
    parameters:
      P:
        type: str
        description: |-
          PV Prefix

      R:
        type: str
        description: |-
          PV Suffix

      PORT:
        type: id
        description: |-
          Port name for the camera

      ID:
        type: str
        description: |-
          Cam ip address, hostname, MAC address, or ID <manufacturer>-<serial>, (e.g. Prosilica-02-2166A-06844)

      BUFFERS:
        type: int
        description: |-
          Maximum number of NDArray buffers to be created for plugin callbacks
        default: 50

      MEMORY:
        type: int
        description: |-
          Max memory to allocate, should be maxw*maxh*nbuffer for driver and all attached plugins
        default: -1

      TIMEOUT:
        type: int
        description: |-
          Timeout, default 1
        default: 1

      ADDR:
        type: int
        description: |-
          Asyn Port address, default 0
        default: 0

    pre_init:
      - value: |
          dbLoadRecords /tmp/genicam/genicam.template "P={{ P }},R={{ R }},PORT={{ PORT }}"
          # aravisConfig(const char *portName, const char *cameraName, size_t maxMemory, int priority, int stackSize)
          aravisConfig("{{PORT}}", "{{ID}}", {{MEMORY}}, 0, 1)

    databases:
      - file: $(ADARAVIS)/db/aravisCamera.template
        args:
          P:
          R:
          PORT:
          TIMEOUT:
          ADDR:

    pvi:
      yaml_path: ADDriver.pvi.device.yaml
      ui_macros:
        P:
        R:
      pv: true
      pv_prefix: $(P)$(R)

  - name: aravisSettings
    description: |-
      Creates detailed settings screens for an Aravis camera
    parameters:
      camera:
        type: object
        description: the aravisCamera object to create settings for
    pvi:
      yaml_path: arvFeature.pvi.device.yaml
      ui_macros:
        P: "{{ camera.P }}"
        R: "{{ camera.R }}"
      pv: true
      pv_prefix: "{{ camera.P }}{{ camera.R }}"
