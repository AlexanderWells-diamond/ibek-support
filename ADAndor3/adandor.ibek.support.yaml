# yaml-language-server: $schema=https://github.com/epics-containers/ibek/releases/download/3.0.1/ibek.support.schema.json
module: ADAndor

entity_models:

  - name: andorCCDTemplate
    description: |-
      TODO:ADD DESCRIPTION
    parameters:
      P:
        type: str
        description: |-
          Device Prefix
      R:
        type: str
        description: |-
          Device Suffix
      PORT:
        type: str
        description: |-
          Asyn Port name
      TIMEOUT:
        type: int
        description: |-
          Timeout
      ADDR:
        type: str
        description: |-
          Asyn Port address
      name:
        type: id
        description: |-
          Object name and gui association name
      SCANRATE:
        type: enum
        description: |-
          Specified scan rate for cpu intensive PVs
        default: I/O Intr
        values:
          .1 second:
          .2 second:
          .5 second:
          1 second:
          2 second:
          5 second:
          10 second:
          I/O Intr:
          Event:
          Passive:

    databases:

      - file: $(ADANDOR)/db/andorCCD.template
        args:
          .*:

  - name: andorCCD
    description: |-
      Creates a andorCCD camera areaDetector driver
    parameters:
      P:
        type: str
        description: |-
          Device Prefix
      R:
        type: str
        description: |-
          Device Suffix
      PORT:
        type: id
        description: |-
          Port name for the detector
      TIMEOUT:
        type: int
        description: |-
          Timeout
      ADDR:
        type: int
        description: |-
          Asyn Port address
      SCANRATE:
        type: enum
        description: |-
          Specified scan rate for cpu intensive PVs
        default: I/O Intr
        values:
          .1 second:
          .2 second:
          .5 second:
          1 second:
          2 second:
          5 second:
          10 second:
          I/O Intr:
          Event:
          Passive:
      name:
        type: str
        description: |-
          Name to use for the detector object and associated gui
        default: Andor
      SHAMROCKID:
        type: int
        description: |-
          shamrockID The index number of the Shamrock spectrograph, if installed.
        default: 0
      BUFFERS:
        type: int
        description: |-
          Maximum number of NDArray buffers to be created for plugin callbacks
        default: 50
      MEMORY:
        type: int
        description: |-
          Max memory to allocate, should be maxw*maxh*nbuffer for driver and all attached plugins
        default: 0
      INSTALLPATH:
        type: str
        description: |-
          Path containing the detector INI files. Can be empty string on Windows if detector doesn't require INI file. For Linux, must be valid path (defaults to using andorCCDSDK used for building this module).
        default: /epics/support/andorCCDSDK/andorCCDSDKApp/src/sdk/andor/etc
      PRIORITY:
        type: int
        description: |-
          The thread priority for the asyn port driver thread
        default: 0
      STACKSIZE:
        type: int
        description: |-
          The stack size for the asyn port driver thread
        default: 100000

    databases:

      - file: $(ADANDOR)/db/andorCCD.template
        args:
          P:
          R:
          PORT:
          TIMEOUT:
          ADDR:
          name:
          SCANRATE:

    pre_init:

      - value: |
          # andorCCDConfig(portName, installPath, shamrockID, maxBuffers, maxMemory, priority, stackSize)
          andorCCDConfig("{{PORT}}", "{{INSTALLPATH}}", {{SHAMROCKID}}, {{BUFFERS}}, {{MEMORY}}, {{PRIORITY}}, {{STACKSIZE}})

  - name: andorCCD_DLSGui
    description: |-
      TODO:ADD DESCRIPTION
    parameters:
      name:
        type: id
        description: |-
          object name and gui association name
      P:
        type: str
        description: |-
          Device Prefix
      R:
        type: str
        description: |-
          Device Suffix
      PORT:
        type: str
        description: |-
          Asyn Port name

    databases:

      - file: $(ADANDOR)/db/andorCCD-DLSGui.template
        args:
          .*:
